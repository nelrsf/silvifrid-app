<div class="container-fluid">
  <div class="row">
    <div class="col-md-8 mx-auto">
      <div class="card">
        <div class="card-header bg-primary text-white">
          <h4 class="mb-0">
            <fa-icon [icon]="faBox"></fa-icon>
            {{ isEditMode ? 'Editar Producto' : 'Crear Nuevo Producto' }}
          </h4>
        </div>
        
        <div class="card-body">
          <!-- Loading state -->
          <div *ngIf="isLoading" class="text-center py-4">
            <div class="spinner-border" role="status">
              <span class="visually-hidden">Cargando...</span>
            </div>
            <p class="mt-2">Cargando producto...</p>
          </div>

          <!-- Form -->
          <form *ngIf="!isLoading" [formGroup]="productForm" (ngSubmit)="onSubmit()">
            <div class="row">
              <!-- Basic Information -->
              <div class="col-md-6">
                <h5 class="text-muted mb-3">
                  <fa-icon [icon]="faInfoCircle"></fa-icon> Información Básica
                </h5>
                
                <!-- Product Name -->
                <div class="mb-3">
                  <label for="name" class="form-label">Nombre del Producto *</label>
                  <input 
                    type="text" 
                    class="form-control"
                    [class.is-invalid]="isFieldInvalid('name')"
                    id="name" 
                    formControlName="name"
                    placeholder="Ej: Victoria's Secret Aqua Kiss">
                  <div *ngIf="isFieldInvalid('name')" class="invalid-feedback">
                    {{ getFieldError('name') }}
                  </div>
                </div>

                <!-- Price -->
                <div class="mb-3">
                  <label for="price" class="form-label">Precio Base (COP) *</label>
                  <div class="input-group">
                    <span class="input-group-text">
                      <fa-icon [icon]="faDollarSign"></fa-icon>
                    </span>
                    <input 
                      type="number" 
                      class="form-control"
                      [class.is-invalid]="isFieldInvalid('price')"
                      id="price" 
                      formControlName="price"
                      placeholder="22000"
                      min="1">
                    <div *ngIf="isFieldInvalid('price')" class="invalid-feedback">
                      {{ getFieldError('price') }}
                    </div>
                  </div>
                </div>

                <!-- Extended Price -->
                <div class="mb-3">
                  <label for="extendedPrice" class="form-label">Precio Extendido (Mayoreo/Promoción) *</label>
                  <div class="input-group">
                    <span class="input-group-text">
                      <fa-icon [icon]="faDollarSign"></fa-icon>
                    </span>
                    <input 
                      type="number" 
                      class="form-control"
                      [class.is-invalid]="isFieldInvalid('extendedPrice')"
                      id="extendedPrice" 
                      formControlName="extendedPrice"
                      placeholder="29500"
                      min="1">
                    <div *ngIf="isFieldInvalid('extendedPrice')" class="invalid-feedback">
                      {{ getFieldError('extendedPrice') }}
                    </div>
                  </div>
                  <div class="form-text">
                    Precio para ventas al mayoreo o promociones especiales
                  </div>
                </div>

                <!-- Stock -->
                <div class="mb-3">
                  <label for="stock" class="form-label">Cantidad en Stock *</label>
                  <input 
                    type="number" 
                    class="form-control"
                    [class.is-invalid]="isFieldInvalid('stock')"
                    id="stock" 
                    formControlName="stock"
                    placeholder="3"
                    min="0">
                  <div *ngIf="isFieldInvalid('stock')" class="invalid-feedback">
                    {{ getFieldError('stock') }}
                  </div>
                </div>

                <!-- Description -->
                <div class="mb-3">
                  <label for="description" class="form-label">Descripción *</label>
                  <textarea 
                    class="form-control"
                    [class.is-invalid]="isFieldInvalid('description')"
                    id="description" 
                    formControlName="description"
                    rows="6"
                    placeholder="Siente la frescura de Aqua Kiss, una fragancia floral acuática que te transporta a un jardín de ensueño..."></textarea>
                  <div *ngIf="isFieldInvalid('description')" class="invalid-feedback">
                    {{ getFieldError('description') }}
                  </div>
                  <div class="form-text">
                    {{ productForm.get('description')?.value?.length || 0 }}/1000 caracteres
                  </div>
                </div>
              </div>

              <!-- Images Section -->
              <div class="col-md-6">
                <h5 class="text-muted mb-3">
                  <fa-icon [icon]="faImages"></fa-icon> Imágenes del Producto
                </h5>

                <!-- Demo Images Selection -->
                <div *ngIf="selectedDemoImages.length > 0" class="mb-3">
                  <label class="form-label">Seleccionar Imágenes de Demo</label>
                  <div class="row g-2">
                    <div *ngFor="let imageUrl of selectedDemoImages; let i = index" class="col-6 col-lg-4">
                      <div class="image-card demo-image" 
                           [class.selected]="images.includes(imageUrl)"
                           (click)="onDemoImageSelect(imageUrl)">
                        <img 
                          [src]="imageUrl" 
                          [alt]="'Imagen de demo ' + (i + 1)"
                          class="img-fluid rounded"
                          style="width: 100%; height: 120px; object-fit: cover;">
                        
                        <div class="demo-overlay" *ngIf="!images.includes(imageUrl)">
                          <div class="demo-text">
                            <small>Click para agregar</small>
                          </div>
                        </div>
                        
                        <div *ngIf="images.includes(imageUrl)" class="selected-badge">
                          <span class="badge bg-success">✓ Seleccionada</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Current Images -->
                <div *ngIf="images.length > 0" class="mb-3">
                  <label class="form-label">Imágenes Seleccionadas</label>
                  <div class="row g-2">
                    <div *ngFor="let imageUrl of images; let i = index" class="col-6 col-lg-4">
                      <div class="image-card">
                        <img 
                          [src]="imageUrl" 
                          [alt]="'Imagen del producto ' + (i + 1)"
                          class="img-fluid rounded"
                          style="width: 100%; height: 120px; object-fit: cover;">
                        
                        <div class="image-overlay">
                          <div class="image-actions">
                            <button 
                              type="button"
                              class="btn btn-sm me-1"
                              [class.btn-success]="i === 0"
                              [class.btn-outline-light]="i !== 0"
                              (click)="moveImageToFirst(i)"
                              title="Establecer como principal">
                              <fa-icon [icon]="faStar"></fa-icon>
                            </button>
                            <button 
                              type="button"
                              class="btn btn-sm btn-outline-danger"
                              (click)="removeImage(i)"
                              title="Eliminar imagen">
                              <fa-icon [icon]="faTrash"></fa-icon>
                            </button>
                          </div>
                        </div>
                        
                        <div *ngIf="i === 0" class="main-badge">
                          <span class="badge bg-success">Principal</span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="form-text">
                    La primera imagen será la imagen principal del producto
                  </div>
                </div>

                <!-- No images message -->
                <div *ngIf="images.length === 0" class="alert alert-warning">
                  <fa-icon [icon]="faExclamationTriangle"></fa-icon>
                  <strong>Atención:</strong> Debe seleccionar al menos una imagen del producto.
                </div>
              </div>
            </div>

            <!-- Form Actions -->
            <div class="row mt-4">
              <div class="col-12">
                <div class="d-flex justify-content-end gap-2">
                  <button 
                    type="button" 
                    class="btn btn-secondary"
                    (click)="cancel()"
                    [disabled]="isSaving">
                    <fa-icon [icon]="faTimes"></fa-icon> Cancelar
                  </button>
                  <button 
                    type="submit" 
                    class="btn btn-primary"
                    [disabled]="productForm.invalid || images.length === 0 || isSaving">
                    <span *ngIf="isSaving" class="spinner-border spinner-border-sm me-2" role="status"></span>
                    <fa-icon *ngIf="!isSaving" [icon]="faSave"></fa-icon>
                    {{ isEditMode ? 'Actualizar' : 'Crear' }} Producto
                  </button>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>